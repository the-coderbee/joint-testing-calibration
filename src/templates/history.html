{% extends "base.html" %}

{% block title %}Prediction History{% endblock %}

{% block content %}
<div data-aos="fade-up" data-aos-duration="1000">
    <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">Prediction History</h1>

    {% if predictions %}
        <div class="max-w-6xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="200">
            <div class="bg-white rounded-xl shadow-card overflow-hidden hover-scale">
                <div class="gradient-animate px-8 py-6 text-white">
                    <h5 class="text-2xl font-bold">Calibration Curve</h5>
                </div>
                <div class="p-8 text-center">
                    <img src="data:image/png;base64,{{ plot_url }}" alt="Calibration Curve" class="max-w-full h-auto mx-auto rounded-lg shadow-md">
                    <p class="text-xl text-gray-600 mt-6">Calibration curve based on all historical predictions</p>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="300">
            <div class="bg-white rounded-xl shadow-card overflow-hidden p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Search Predictions</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <input type="text" id="tableSearch" class="w-full px-5 py-3 text-lg rounded-full border-2 border-primary-300 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 shadow-sm transition-colors" placeholder="Search history...">
                    </div>
                    <div>
                        <button class="w-full px-5 py-3 text-lg bg-gray-200 hover:bg-gray-300 rounded-full transition-colors shadow-sm font-medium" id="resetFilters">
                            Reset Filters
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-6xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="400">
            <div class="bg-white rounded-xl shadow-card overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full" id="historyTable">
                        <thead>
                            <tr class="gradient-animate text-white">
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">ID</th>
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">Timestamp</th>
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">Prediction</th>
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">Actual Value</th>
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">Sensor ID</th>
                                <th class="px-6 py-4 text-left text-lg font-semibold uppercase tracking-wider">Equipment ID</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            {% for record in predictions %}
                            <tr class="hover:bg-gray-50 transition-colors" data-aos="fade-up" data-aos-delay="{{ loop.index * 30 }}" data-aos-anchor-placement="top-bottom">
                                <td class="px-6 py-4 whitespace-nowrap text-lg text-gray-900">{{ record['id'] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-lg text-gray-900">{{ record['timestamp'] }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-lg font-medium text-primary-600">{{ record['prediction']|round(4) }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-lg text-gray-900">{{ record['actual_value']|default('N/A', true) }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-lg text-gray-900">{{ record['sensor_id']|default('N/A', true) }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-lg text-gray-900">{{ record['equipment_id']|default('N/A', true) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% else %}
        <div class="max-w-4xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="200">
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 text-blue-700 p-8 rounded-xl shadow-md">
                <h4 class="text-2xl font-bold mb-4">No prediction history found</h4>
                <p class="text-xl mb-6">Make some predictions first to see your history here.</p>
                <a href="/" class="bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-600 hover:to-primary-800 text-white text-xl font-semibold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 inline-block">
                    Make Predictions
                </a>
            </div>
        </div>
    {% endif %}

    <div class="flex justify-center mb-12" data-aos="fade-up" data-aos-delay="500">
        <a href="/" class="bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-600 hover:to-primary-800 text-white text-xl font-semibold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
            Back to Predictor
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Table search functionality
    const tableSearch = document.getElementById('tableSearch');
    const resetFilters = document.getElementById('resetFilters');
    const historyTable = document.getElementById('historyTable');
    
    if (historyTable) {
        const tableRows = historyTable.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
        
        function applyFilters() {
            const searchText = tableSearch.value.toLowerCase();
            
            for (let row of tableRows) {
                let matchesSearch = false;
                
                // Search filter
                for (let cell of row.getElementsByTagName('td')) {
                    if (cell.textContent.toLowerCase().includes(searchText)) {
                        matchesSearch = true;
                        break;
                    }
                }
                
                // Show/hide row based on filters
                row.style.display = matchesSearch ? '' : 'none';
            }
        }
        
        if (tableSearch) {
            tableSearch.addEventListener('input', applyFilters);
        }
        
        if (resetFilters) {
            resetFilters.addEventListener('click', function() {
                if (tableSearch) tableSearch.value = '';
                applyFilters();
            });
        }
    }
</script>
{% endblock %} 